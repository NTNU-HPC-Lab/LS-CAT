#include "includes.h"
const int  Nthreads = 1024,  NrankMax = 3, nt0max = 71, NchanMax = 1024;

//////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////
__global__ void getwtw(const double *Params, const double *dWU, double *wtw){

int nt0, tidx, tidy, bid, Nchan,k;
double x;

nt0       = (int) Params[4];
Nchan     = (int) Params[9];

tidx 		= threadIdx.x;
tidy 		= threadIdx.y;

bid 		= blockIdx.x;

while (tidy<nt0){
x = 0.0f;
for (k=0; k<Nchan; k++)
x += dWU[tidx + k*nt0 + bid * Nchan*nt0] *
dWU[tidy + k*nt0 + bid * Nchan*nt0];
wtw[tidx + tidy*nt0 + bid * nt0*nt0] = x;

tidy+=blockDim.y;
}
}